<!DOCTYPE html>

<html lang="en-US">

<head>
  <title>WeeNAS Initial Configuration</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link id="page-style" href="hello.css" rel="stylesheet" type="text/css">

  <script>
    /* Figure out whence we came and put the hostname in the header. */
    function showHostname() {
      if (window.location.hostname) {
        document.getElementById('hostname').innerHTML = window.location.hostname;
      }
    }

    function checkMatch() {
      if (document.getElementById('password-new').value == document.getElementById('password-confirm').value) {
        document.getElementById('password-match').innerHTML = '&#x1F44D;&#x1F3FD;';
      }
      else {
        document.getElementById('password-match').innerHTML = '&#x1F44E;&#x1F3FD;';
      }
    }

    /* AJAX set user attribute (lock/unlock, trusted/untrusted) */
    function setUser(user, attribute) {
      if (user) {
        document.body.style.cursor = 'wait';
        url = './user/' + user + '/' + attribute;
        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
          if (this.readyState === 4) {
            if (this.status !== 200) alert('Error: ' + this.responseText);
            document.body.style.cursor = 'default';
          }
        };
        xhttp.open('PUT', url, true);
        xhttp.send();
      }
    }

    /* API call to add user(s) */
    function addUsers(userList) {
      if (userList) {
        document.body.style.cursor = 'wait';
        let users = userList.split(' ');
        let xhttp = [];
        for (let i = 0; i < users.length; i++) {
          url = './user/' + users[i];
          xhttp[i] = new XMLHttpRequest();
          xhttp[i].onreadystatechange = function () {
            if (xhttp[i].readyState === 4) {
              if (xhttp[i].status == 200) setUser(users[i], 'trusted');
              else alert('Error: ' + xhttp[i].responseText);
              document.body.style.cursor = 'default';
            }
          };
          xhttp[i].open('POST', url, true);
          xhttp[i].send('');
        }
      }
    }
  </script>
</head>

<body onload="showHostname(); getDiskInfo('da0', updateDiskInfo);">
  <!-- Turn on night mode between the hours of 6 p.m. and 6 a.m. -->
  <script>let d = new Date(); if (d.getHours() < 6 || d.getHours() >= 18) document.getElementById('page-style').setAttribute('href', 'hello-night.css');</script>

  <header>
    <h1 id="hostname">WeeNAS</h1>
  </header>

  <nav>
    <p>
    </p>
  </nav>

  <main class="narrow">
    <h2>Password Change</h2>

    <p><b>Username</b></p>
    <div style="margin-left: 1em;">
      <input id="username" size=15 type="text">
    </div>

    <p><b>Recovery Secret</b></p>
    <div style="margin-left: 1em;">
      <label>What is your favorite color?</label><br>
      <input id="secret" size=32 type="password">
    </div>

    <p><b>New Password</b></p>
    <div style="margin-left: 1em;">
      <input id="password-new" onchange="checkMatch();" placeholder="Enter here." size=32 type="password">
      <input id="password-confirm" oninput="checkMatch();" placeholder="Repeat to confirm." size=32 type="password">
      <span id="password-match"></span>

    </div>

    <p><b>Change It</b></p>
    <div onmouseover="toggleBlurb('finalizing-blurb');" onmouseout="toggleBlurb('general-blurb');"
      style="margin-left: 1em;">
      <p>
        <button class="wide" onclick="writeConfig();" title="Save password." type="button">&#x1F511; &#x0279C;
          &#x1F4BB;</button>
      </p>
    </div>
  </main>

  <aside class="wide">
    <h2>Guidelines</h2>
    <p>
      If you're setting up a password for a new account, be sure to answer the security question. This will enable
      you to reset your password later in case you forget it.
    </p>
    <p>
      If you're resetting a password, enter the answer to your security question.
    </p>
    <p>
      Enter and confirm your new password. You may use a combination of letters, numbers, and special characters up
      to thirty-two characters in length. If you see a thumbs up, your passwords match and you can proceed. A thumbs
      down means you need to try again.
    </p>
  </aside>

  <footer>
    <p><a href="https://davescodemusings.github.io/WeeNAS" target="_blank">WeeNAS = Raspberry Pi + Flash Drive + FreeBSD
        + Samba</a></p>
  </footer>
</body>

</html>