<!DOCTYPE html>

<html lang="en-US">

<head>
  <title>WeeNAS Administration</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link id="page-style" href="hello.css" rel="stylesheet" type="text/css">
  <script src="admin.js"></script>
  <script src="tzNamesLib.js"></script>
  <script>
    /* Figure out whence we came and put the hostname in the header. */
    function showHostname() {
      if (window.location.hostname) {
        document.getElementById('hostname').innerHTML = window.location.hostname;
      }
    }
  </script>
</head>

<body onload="showHostname(); document.getElementById('credentials-username').focus();">
  <!-- Turn on night mode between the hours of 6 p.m. and 6 a.m. -->
  <script>let d = new Date(); if (d.getHours() < 6 || d.getHours() >= 18) document.getElementById('page-style').setAttribute('href', 'hello-night.css');</script>

  <header>
    <h1 id="hostname">WeeNAS</h1>
  </header>

  <nav>
    <p>
      <a href="javascript:logOut();">Log Out</a>
    </p>
  </nav>

  <main class="narrow">
    <h2>Administration</h2>

    <details id="credentials" open>
      <summary><span id="credentials-icon" style="opacity: 0.25;">&#x1F511;</span> Admin Credentials</summary>
      <div class="indent">
        <table>
          <tr>
            <td><label>Username</label></td>
            <td><input id="credentials-username" type="text"></td>
          </tr>
          <tr>
            <td><label>Password</label></td>
            <td><input id="credentials-password" type="password"
                onchange="createAuth(document.getElementById('credentials-username').value, document.getElementById('credentials-password').value, credentialsEntered);">
              <span id="credentials-state"></span>
            </td>
          </tr>
        </table>
      </div>
    </details>

    <!-- User Account Management -->
    <details>
      <summary>&#x1F464; User Accounts</summary>
      <div class="indent">
        <details>
          <summary>&#x02795; Add</summary>
          <div class="indent">
              <table>
                <tr>
                  <td><input id="user-add-list" type="text" size="35em" maxlength="60" pattern="[a-z0-9 ]+"
                      placeholder="Lowercase; separate with spaces."></td>
                  <td>
                    <button onclick="addUserList(document.getElementById('user-add-list').value)" type="button">&#x1F464;&#x0279C;&#x1F4BB;</button>
                  </td>
                </tr>
              </table>
          </div>
        </details>
        <details id="users-manage">
          <summary
            onclick="if (!document.getElementById('users-manage').hasAttribute('open')) getUsers(updateUserList);">
            &#x1F527; Manage</summary>
          <div class="indent">
              <table>
                <tr>
                  <th>User</th>
                  <th>Details</th>
                </tr>
                <tr>
                  <td><select id="user-list" onchange="getuserDetails(document.getElementById('user-list').value, updateUserDetails);" size=6 style="width: 10em;"></select></td>
                  <td>
                      <input id="user-locked" onchange="user=document.getElementById('user-list').value; if (document.getElementById('user-locked').checked) setUserAttribute(user, 'locked'); else setUserAttribute(user,'unlocked');" type="checkbox"> &#x1F512; Account Locked<br>
                      <input id="user-samba" onchange="user=document.getElementById('user-list').value; if (document.getElementById('user-samba').checked) setUserAttribute(user, 'samba'); else setUserAttribute(user,'nosamba');" type="checkbox"> &#x1F4C2; Network Shares<br>
                      <input id="user-shell" onchange="user=document.getElementById('user-list').value; if (document.getElementById('user-shell').checked) setUserAttribute(user, 'shell'); else setUserAttribute(user,'nologin');" type="checkbox"> &#x1F4BB; Shell Access<br>
                      <input id="user-admin" onchange="user=document.getElementById('user-list').value; if (document.getElementById('user-admin').checked) setUserAttribute(user, 'admin'); else setUserAttribute(user,'regular');" type="checkbox"> &#x1F9D9; Admin User<br>
                      <input id="user-delete-confirm" type="checkbox"> &#x1F47B; <button onclick="delUser(document.getElementById('user-list').value, document.getElementById('user-delete-confirm').checked)" type="button">&#x0274C;</button>
                  </td>
                </tr>
              </table>
          </div>
        </details>
      </div>
    </details>

    <!-- Storage Management -->

    <details>
      <summary>&#x1F4BE; Storage Devices</summary>
      <div class="indent">
        <details id="storage-home">
          <summary onclick="if (!document.getElementById('storage-home').hasAttribute('open')) getFilesystemInfo('homefs', updateHomefsInfo);">&#x1F3E1; Home Filesystem</summary>
          <div class="indent">
            <table>
              <tr>
                <td>Label:</td>
                <td>homefs</td>
              </tr>
              <tr>
                <td>Capacity:</td>
                <td id="storage-home-total"></td>
              </tr>
              <tr>
                <td>Free:</td>
                <td id="storage-home-free"></td>
              </tr>
              <tr>
                <td>Percent Full:</td>
                <td id="storage-home-percent"></td>
              </tr>
            </table>
          </div>
        </details>
      </div>
    </details>

    <!-- System Settings -->

    <details>
      <summary>&#x1F4BB; System Settings</summary>
      <div class="indent">

        <!-- Host and Domain Name -->
        <details id="host-and-domain">
          <summary onclick="if (!document.getElementById('hostname').hasAttribute('open')) getHostname();">
            &#x1F5A5;&#x0FE0F; Host and Domain Name</summary>
          <div class="indent">
            <input id="hostname-host" type="text"> . <input id="hotname-domain" type="text">
          </div>
        </details>

        <!-- TimeZone -->
        <details id="timezone">
          <summary>&#x1F5FA;&#x0FE0F; Timezone</summary>
          <div class="indent">
            <select id="tz-area" onchange="tzUpdateLocations('tz-area', 'tz-location')">
              <option>Africa</option>
              <option>America</option>
              <option>Antarctica</option>
              <option>Asia</option>
              <option>Atlantic</option>
              <option>Australia</option>
              <option selected>Etc</option>
              <option>Europe</option>
              <option>Indian</option>
              <option>Pacific</option>
            </select>
            /
            <select id="tz-location">
              <option>GMT</option>
            </select>
            <button
              onclick="setTimeZone(document.getElementById('tz-area').options[document.getElementById('tz-area').selectedIndex].value, document.getElementById('tz-location').options[document.getElementById('tz-location').selectedIndex].value)"
              title="Copy timezone configuration to server." type="button">&#x1F4CB;&#x0279C;&#x1F4BB;</button>
          </div>
        </details>

        <!-- Date and Time -->
        <details id="time">
          <summary
            onclick="if (!document.getElementById('time').hasAttribute('open')) { getDateTime(updateDateTime); getServiceStatus('ntpd', updateNtpd); }">
            &#x0231A;
            Date and Time
          </summary>
          <div class="indent">
            <form>
              <table>
                <tr>
                  <td>Client:</td>
                  <td id="time-client"></td>
                </tr>
                <tr>
                  <td>Server:</td>
                  <td id="time-server"></td>
                </tr>
                <tr>
                  <td><label>Sync:</label></td>
                  <td id="time-ntpd"></td>
                </tr>
              </table>
              <button onclick="getDateTime(updateDateTime); getServiceStatus('ntpd', updateNtpd);" title="Refresh Time"
                type="button">&#x21BB;</button>
            </form>
          </div>
        </details>
      </div>
    </details>
  </main>

  <!-- Logs and Email -->
  <aside class="wide">
    <h2>Logs &amp; Messages</h2>
    <details id="logs">
      <summary onclick="if (!document.getElementById('logs').hasAttribute('open')) getLog(logFileName, updateLog);">
        &#x1F4C4; Log Viewer</summary>
      <p>
        <button onclick="getLog(logFileName = 'messages', updateLog);" type="button">system</button>
        <button onclick="getLog(logFileName = 'smbd', updateLog);" type="button">smbd</button>
        <button onclick="getLog(logFileName = 'nmbd', updateLog);" type="button">nmbd</button>
        <button onclick="getLog(logFileName = 'cron', updateLog);" type="button">cron</button>
        <button onclick="getLog(logFileName = 'weenas_api', updateLog);" type="button">api</button>
        <button onclick="getLog(logFileName, updateLog);" title="Refresh Log" type="button">&#x21BB;</button>
      </p>
      <textarea readonly rows=25 cols=80 id="log-viewer"></textarea>
    </details>
    <details id="mail">
      <summary onclick="if (!document.getElementById('mail').hasAttribute('open')) getMail(0, updateMail);">&#x1F4E7;
        System Mail</summary>
      <p>
        <button onclick="getMail(0,updateMail);" title="Header View" type="button">&#x1F4D1;</button>
        <button onclick="mailMsgNum = Math.max(--mailMsgNum, 0); getMail(mailMsgNum, updateMail);"
          title="Previous Message" type="button">&#x25B2;</button>
        <button onclick="getMail(++mailMsgNum, updateMail);" title="Next Message" type="button">&#x25BC;</button>
        <button onclick="delMail(mailMsgNum); getmail(0, updateMail);" title="Delete Message"
          type="button">&#x274C;</button>
      </p>
      <textarea readonly rows="25" cols="80" id="mail-view"></textarea>
    </details>
  </aside>

  <footer>
    <p>
      <a href="https://davescodemusings.github.io/WeeNAS" target="_blank">WeeNAS</a>
      = <a href="https://www.raspberrypi.org" target="_blank">Raspberry Pi &trade;</a>
      + <a href="https://en.wikipedia.org/wiki/USB_flash_drive" target="_blank">Flash Drive</a>
      + <a href="https://www.freebsd.org/" target="_blank">FreeBSD &reg;</a>
      + <a href="https://www.samba.org/" target="_blank">Samba &trade;</a>
    </p>
  </footer>
</body>

</html>