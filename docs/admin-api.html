<!DOCTYPE html>

<html>

<head>
  <title>WeeNAS Project</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="style.css" rel="stylesheet" type="text/css">
</head>

<body>
  <header>
    <h1>WeeNAS</h1>
    <p>Raspberry Pi + Flash Drive + FreeBSD + Samba</p>
  </header>
  <nav>
    <h2>Navigation</h2>
    <ul>
      <li><a href="index.html">About</a></li>
      <li><a href="prerequisites.html">Prerequisites</a></li>
      <li><a href="initial-config.html">Initial configuration</a></li>
      <li><a href="admin-cli.html">Command-line Administration</a></li>
      <li>Administration via API</li>
      <li><a href="https://github.com/DavesCodeMusings/WeeNAS/" target="_blank">WeeNAS GitHub Repo</a></li>
    </ul>
  </nav>

  <main>
    <h2>Administration via API</h2>
    <p>WeeNAS has an API, built on Node.js, that can be used to administer the system using a simple set of commands.
      Administration can be performed by any of the trusted user accounts (those in the wheel group) and does not
      require any knowledge of Samba or FreeBSD commands.</p>
    <p>The admin API is incomplete at this time.</p>

    <h2>Installing and Starting the API</h2>
    <ol>
      <li>Log in as a trusted user and su to root.</li>
      <li>Install Node.js with the command 'pkg install node-13'.</li>
      <li>Copy the weenas-api.js program into /root/weenas</li>
      <li>Run 'node /root/weenas/weenas-api.js'</li>
    </ol>

    <h2>Connecting to the API</h2>
    <p>There is no client program at this time. Netcat is used in the interim.</p>
    <ol>
      <li>Log into the system as one of the trusted user accounts (member of the wheel group.)</li>
      <li>'nc -U /var/run/weenas.sock' is the command to connect Netcat to the API's filesystem socket.</li>
      <li>API commands that can be used are described below.</li>
    </ol>

    <h2>Commands</h2>
    <p>All commands take on a form of <i>verb-noun</i> with the verb being the operation you are performing and the noun
      being the system resource you are performing it on. The verbs are limited to the operations: new, get, set, and
      delete. The noun potion is heirarchial in its structure and can get quite lengthy, particularly when it comes to
      specifying disks and partitions.</p>
    <p>Some samples of common commands are shown below.</p>
    <ul>
      <li>'new user cthulhu' creates a user account for Cthulhu.</li>
      <li>'del user cthulhu' will delete the great old one's account.</li>
      <li>'get disks' shows all of the available storage devices by device name.</li>
      <li>'get disk da0 part 1 filesystem label' would return the label associated with /dev/da0p1</li>
      <li>'set disk da0 part 1 filesystem label homefs' would assign homefs to the filesytem on /dev/da0p1</li>
    </ul>
    <p>The command interpreter is not very friendly. No help option is given and there is no command history.  This will
      most likely be built into the client when it comes around.</p>

    <h2>REST API</h2>
    <p>The REST portion of the API is now complete.  It can be activated by supplying a port number when starting the API.
      For example, 'node weenas-api.js 9000' will make the REST API available on tcp port 9000. Just point your web
      browser there to access WeeNAS resources.</p>
    <p>The REST API also takes on the <i>verb-noun</i> format with the verbs being supplied by the HTML method. An HTTP
      GET corresponds to a get command when using the command-line API. As an example, the 'get disks' command issued to
      the command-line API would show the names of storage devices installed.  Pointing a browser to http://wenass:9000/disks
      would do the same thing.</p>
    <p>Any 'get' command that can be issued to the command-line API can be used with the REST API and a browser.  Simply
      type everything after the 'get' as a URL separated by slashes.  For example, http://weenas:9000/cpu/temperature will
      return the temperature of the Raspberry Pi's CPU.  http://weenas:9000/disk/da0/part/1/filesystem/label will return
      the label given to /dev/da0p1's filesystem.</p>
    <p>Commands that involve the actions of new, set, or del correspond to the HTTP verbs POST, PUT and DELETE.  These can
      currently only be issued by a tool like <a href="https://en.wikipedia.org/wiki/CURL" target="_blank">curl</a> and its
      -X option to set the request type.  For example, 'curl -X POST http://127.0.0.1:9000/user/test' will create a new user
      by the name of 'test'.  The forthcoming administration web page will allow this to be done in a browser.</p>

    <h2>Future Plans</h2>
    <p>The next efforts will be focused on providing an HTML page for web-based administration and an authentication
      mechanism to prevent accidental or malicious changes being made through the API.</p>
  </main>

  <aside>
    <h2>Quick Links</h2>
    <ul>
      <li><a href="https://github.com/DavesCodeMusings/WeeNAS/tree/master/api" target="_blank">The WeeNAS API on
          GitHub</a></li>
    </ul>
  </aside>

  <footer>
    <p>WeeNAS is not associated with, nor is it endorsed by: FreeNAS, the Raspberry Pi Foundation, FreeBSD, or the Samba
      project.</p>
  </footer>
</body>

</html>