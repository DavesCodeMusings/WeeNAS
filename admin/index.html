<!DOCTYPE html>

<html lang="en-US">

<head>
  <title>WeeNAS Monitor</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="style.css" rel="stylesheet" type="text/css">
  <style>
    details {
      padding-bottom: 1em;
    }
    main details, main summary {
      width: 640px;
    }
    aside details, aside summary {
      width: 320px;
    }
    .rt-just {
      text-align: right;
    }
  </style>
  <!-- Rounded270Gauge from https://davescodemusings.github.io/htmlGauges/ -->
  <script src="Rounded270Gauge.js"></script>
  <script>
    /* Figure out whence we came and put the hostname in the header. */
    function showHostname () {
      if (window.location.hostname) {
        document.getElementById('hostname').innerHTML = window.location.hostname;
      }
    }

    /* Open up <details> all at once. */
    function openDetails() {
      let elements = document.getElementsByTagName('details');
      for (let i=1; i<elements.length; i++) {
        elements[i].setAttribute('open', '');
      }
    }

    /* AJAX statistic fetcher. */
    function getStat(url, element) {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById(element).innerHTML = this.responseText;
        }
      };
      xhttp.open("GET", url, true);
      xhttp.send();
    }
</script>
</head>

<body onload="showHostname(); getStat('/system/memory/free', 'system-memory-summary'); getStat('/system/top', 'system-top');">
<header>
<h1 id="hostname">WeeNAS</h1>
</header>
<nav>
  <p>
    <a href="javascript:openDetails();">Expand All</a>
    |
    <a href="admin.html">Administrator Login</a>
  </p>
</nav>

<main>
  <h2>System</h2>
  <details id="system-cpu-load" open>
    <summary>CPU Load</summary>
    <canvas id="load-one" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <canvas id="load-five" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <canvas id="load-fifteen" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <canvas id="cpu-use" height=200 width=200></canvas>
    <canvas id="cpu-temp" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <script>
      new Rounded270Gauge('load-one', '1m', 0.5, true);
      new Rounded270Gauge('load-five', '5m', 0.3, true);
      new Rounded270Gauge('load-fifteen', '15m', 0.2, true);
      new Rounded270Gauge('cpu-use', 'CPU %', 0.1, true);
      new Rounded270Gauge('cpu-temp', 'CPU â„ƒ', 0.34, true);
    </script>
  </details>

  <details id="system-memory">
    <summary>Memory <span id="system-memory-summary"></span> free</summary>
    <canvas id="active" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <canvas id="inactive" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <canvas id="laundry" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <canvas id="wired" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <canvas id="buffer" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <canvas id="free" height=100 width=100 style="padding-bottom:25px;"></canvas>
    <script>
      new Rounded270Gauge('active', 'Active', 0.5, true);
      new Rounded270Gauge('inactive', 'Inactive', 0.3, true);
      new Rounded270Gauge('laundry', 'Laundry', 0.2, true);
      new Rounded270Gauge('wired', 'Wired', 0.1, true);
      new Rounded270Gauge('buffer', 'Buffer', 0.3, true);
      new Rounded270Gauge('free', 'Free', 0.34, true);
    </script>
  </details>

  <details id="top">
    <summary>Top Tasks</summary>
    <pre id='system-top'>
    </pre>
  </details>
</main>

<aside>
  <h2>Storage</h2>
  <details id="rootfs">
    <summary>rootfs on /</summary>
    <canvas id="rootfs-use" height=200 width=200></canvas>
    <script>
      new Rounded270Gauge('rootfs-use', '% Full', 0.67, true);
    </script>
  </details>

  <details id="homefs">
    <summary>homefs on /home</summary>
    <canvas id="homefs-use" height=200 width=200></canvas>
    <script>
      new Rounded270Gauge('homefs-use', '% Full', 0.34, true);
    </script>
  </details>

  <details id="backupfs">
    <summary>backupfs on /media/backup</summary>
    <canvas id="backupfs-use" height=200 width=200></canvas>
    <script>
      new Rounded270Gauge('backupfs-use', '% Full', 0.85, true);
    </script>
  </details>

  <details id="da0">
    <summary>da0</summary>
    <canvas id="da0-read" height=100 width=100></canvas>
    <canvas id="da0-write" height=100 width=100></canvas>
    <script>
      new Rounded270Gauge('da0-read', 'Read', 0.1, true);
      new Rounded270Gauge('da0-write', 'Write', 0, true);
    </script>
  </details>

  <details id="da1">
    <summary>da1</summary>
    <canvas id="da1-read" height=100 width=100></canvas>
    <canvas id="da1-write" height=100 width=100></canvas>
    <script>
      new Rounded270Gauge('da1-read', 'Read', 0, true);
      new Rounded270Gauge('da1-write', 'Write', 0.6, true);
    </script>
  </details>
</aside>

<footer>
  <p><a href="https://davescodemusings.github.io/WeeNAS" target="_blank" style="color: whitesmoke;">WeeNAS Project Home</a></p>
</footer>

</body>

</html>